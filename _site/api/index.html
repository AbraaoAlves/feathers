<!DOCTYPE html>
<html>
  <head>
    <meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="description" content="">
    <meta name="author" content="">
    <link rel="shortcut icon" href="/ico/favicon.png">

    <title>Feathers - API</title>
    <link href="/css/feathers.min.css" rel="stylesheet">
    <link href="/css/fontello.css" rel="stylesheet">
    <link rel="canonical" href="http://yourdomain.com/api/">
  </head>
  <body data-spy="scroll" data-offset="100">
    <div class="navbar-wrapper">
      <div class="navbar navbar-inverse navbar-fixed-top">
        <div class="container">
          <div class="navbar-header">
            <button type="button" class="navbar-toggle" data-toggle="collapse" data-target=".navbar-collapse">
              <span class="icon-feather"></span>
            </button>
            <a class="navbar-brand" href="#">
              <i class="icon-feather"></i> Feathers
            </a>
          </div>
          <div class="navbar-collapse collapse pull-right">
            <ul class="nav navbar-nav">
              
                
                  
                
                  
                
                  
                    <li>
                      <a class="page-link " href="/">
                        Guide
                      </a>
                    </li>
                  
                
                  
                
              
                
                  
                    <li>
                      <a class="page-link active" href="/api/">
                        API
                      </a>
                    </li>
                  
                
                  
                
                  
                
                  
                    <li>
                      <a class="page-link " href="/plugins/">
                        Plugins
                      </a>
                    </li>
                  
                
              
                
                  
                
                  
                
                  
                
                  
                
              
                
                  
                
                  
                    <li>
                      <a class="page-link " href="/faq/">
                        FAQ
                      </a>
                    </li>
                  
                
                  
                
                  
                
              
                
                  
                
                  
                
                  
                
                  
                
              
                
                  
                
                  
                
                  
                
                  
                
              
                
                  
                
                  
                
                  
                
                  
                
              
                
                  
                
                  
                
                  
                
                  
                
              
                
                  
                
                  
                
                  
                
                  
                
              
                
                  
                
                  
                
                  
                
                  
                
              
              <li>
                <a class="page-link" href="https://github.com/feathersjs/feathers">
                  <strong>Github</strong>
                </a>
              </li>
            </ul>
          </div>
        </div>
      </div>
    </div>

    <div class="content"><section class="page">
  <div class="container">
    <div class="row">
      <div class="col-md-3">
        <div id="toc"></div>
      </div>
      <div class="col-md-9 page-content">
        <h2 id="introduction">Introduction</h2>

<p>Feathers is a light weight web application framework that rides on top of <a href="http://expressjs.com">Express</a>, one of the most popular web frameworks for <a href="http://nodejs.org/">NodeJS</a>. It makes it easy to create RESTful web services and real-time applications using SocketIO and several other NodeJS real-time libraries.</p>

<p>If you are not familiar with Express head over to the <a href="http://expressjs.com/guide.html">Express Guides</a> to get an idea. Feathers works the exact same way except that <code>var app = require('express')();</code> is replaced with <code>var app = require('feathers')()</code>. The most important concept that Feathers adds to Express middleware is data oriented <strong>Services</strong>. How services work and the API additional to the available <a href="http://expressjs.com/api.html">Express API</a> is outlined in the following documentation.</p>

<h2 id="configuration">Configuration</h2>

<h3 id="rest">REST</h3>

<p>In almost every case you want to expose your services through a RESTful JSON interface. This can be achieved by calling <code>app.configure(feathers.rest())</code>. Note that you will have to provide your own body parser middleware like the standard <a href="https://github.com/expressjs/body-parser">Express 4 body-parser</a> to make REST <code>.create</code>, <code>.update</code> and <code>.patch</code> calls pass the parsed data.</p>

<p>To set service parameters in a middleware, just attach it to the <code>req.feathers</code> object which will become the params for any resulting service call. It is also possible to use URL parameters for REST API calls which will also be added to the params object:</p>

<div><div class="CodeRay">
  <div class="code"><pre><span style="color:#080;font-weight:bold">var</span> bodyParser = require(<span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">'</span><span style="color:#D20">body-parser</span><span style="color:#710">'</span></span>);

app.configure(feathers.rest())
  .use(bodyParser.json())
  .use(bodyParser.urlencoded({<span style="color:#606">extended</span>: <span style="color:#069">true</span>}))
  .use(<span style="color:#080;font-weight:bold">function</span>(req, res, next) {
    req.feathers.data = <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">'</span><span style="color:#D20">Hello world</span><span style="color:#710">'</span></span>;
    next();
  });

app.use(<span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">'</span><span style="color:#D20">/:app/todos</span><span style="color:#710">'</span></span>, {
  <span style="color:#06B;font-weight:bold">get</span>: <span style="color:#080;font-weight:bold">function</span>(name, params, callback) {
    console.log(params.data); <span style="color:#777">// -&gt; 'Hello world'</span>
    console.log(params.app); <span style="color:#777">// will be `my` for GET /my/todos/dishes</span>
    callback(<span style="color:#069">null</span>, {
      <span style="color:#606">id</span>: name,
      <span style="color:#606">params</span>: params,
      <span style="color:#606">description</span>: <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">&quot;</span><span style="color:#D20">You have to do </span><span style="color:#710">&quot;</span></span> + name + <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">&quot;</span><span style="color:#D20">!</span><span style="color:#710">&quot;</span></span>
    });
  }
});
</pre></div>
</div>
</div>

<p>The default REST handler is a middleware that formats the data retrieved by the service as JSON. If you would like to configure your own <code>handler</code> middleware just pass it to <code>feathers.rest(handler)</code>. For example a middleware that just renders plain text with the todo description (<code>res.data</code> contains the data returned by the service):</p>

<div><div class="CodeRay">
  <div class="code"><pre>app.configure(feathers.rest(<span style="color:#080;font-weight:bold">function</span> <span style="color:#06B;font-weight:bold">restFormatter</span>(req, res) {
    res.format({
      <span style="color:#606"><span style="color:#404">'</span><span>text/plain</span><span style="color:#404">'</span></span>: <span style="color:#080;font-weight:bold">function</span>() {
        res.end(<span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">'</span><span style="color:#D20">The todo is: </span><span style="color:#710">'</span></span> + res.data.description);
      }
    });
  }))
  .use(<span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">'</span><span style="color:#D20">/todo</span><span style="color:#710">'</span></span>, {
    <span style="color:#06B;font-weight:bold">get</span>: <span style="color:#080;font-weight:bold">function</span> (id, params, callback) {
      callback(<span style="color:#069">null</span>, { <span style="color:#606">description</span>: <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">'</span><span style="color:#D20">You have to do </span><span style="color:#710">'</span></span> + id });
    }
  });
</pre></div>
</div>
</div>

<p>If you want to add other middleware <em>before</em> the REST handler, simply call <code>app.use(middleware)</code> before configuring the handler.</p>

<h3 id="socketio">SocketIO</h3>

<p>To expose services via <a href="http://socket.io/">SocketIO</a> call <code>app.configure(feathers.socketio())</code>. It is also possible pass a <code>function(io) {}</code> when initializing the provider where <code>io</code> is the main SocketIO object. Since Feathers is only using the SocketIO default configuration, this is a good spot to initialize the <a href="https://github.com/LearnBoost/Socket.IO/wiki/Configuring-Socket.IO#recommended-production-settings">recommended production settings</a>:</p>

<div><div class="CodeRay">
  <div class="code"><pre>app.configure(feathers.socketio(<span style="color:#080;font-weight:bold">function</span>(io) {
  io.enable(<span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">'</span><span style="color:#D20">browser client minification</span><span style="color:#710">'</span></span>);  <span style="color:#777">// send minified client</span>
  io.enable(<span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">'</span><span style="color:#D20">browser client etag</span><span style="color:#710">'</span></span>);          <span style="color:#777">// apply etag caching logic based on version number</span>
  io.enable(<span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">'</span><span style="color:#D20">browser client gzip</span><span style="color:#710">'</span></span>);          <span style="color:#777">// gzip the file</span>

  <span style="color:#777">// enable all transports (optional if you want flashsocket support, please note that some hosting</span>
  <span style="color:#777">// providers do not allow you to create servers that listen on a port different than 80 or their</span>
  <span style="color:#777">// default port)</span>
  io.set(<span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">'</span><span style="color:#D20">transports</span><span style="color:#710">'</span></span>, [
      <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">'</span><span style="color:#D20">websocket</span><span style="color:#710">'</span></span>
    , <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">'</span><span style="color:#D20">flashsocket</span><span style="color:#710">'</span></span>
    , <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">'</span><span style="color:#D20">htmlfile</span><span style="color:#710">'</span></span>
    , <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">'</span><span style="color:#D20">xhr-polling</span><span style="color:#710">'</span></span>
    , <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">'</span><span style="color:#D20">jsonp-polling</span><span style="color:#710">'</span></span>
  ]);
}));
</pre></div>
</div>
</div>

<blockquote>
  <p>Note: io.set is deprecated in Socket.IO 1.0. The above configuration will still work but will be replaced with the recommended production configuration for version 1.0 (which isn’t available at the moment).</p>
</blockquote>

<p>This is also the place to listen to custom events or add <a href="https://github.com/LearnBoost/socket.io/wiki/Authorizing">authorization</a>:</p>

<div><div class="CodeRay">
  <div class="code"><pre>app.configure(feathers.socketio(<span style="color:#080;font-weight:bold">function</span>(io) {
  io.on(<span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">'</span><span style="color:#D20">connection</span><span style="color:#710">'</span></span>, <span style="color:#080;font-weight:bold">function</span>(socket) {
    socket.emit(<span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">'</span><span style="color:#D20">news</span><span style="color:#710">'</span></span>, { <span style="color:#606">hello</span>: <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">'</span><span style="color:#D20">world</span><span style="color:#710">'</span></span> });
    socket.on(<span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">'</span><span style="color:#D20">my other event</span><span style="color:#710">'</span></span>, <span style="color:#080;font-weight:bold">function</span> (data) {
      console.log(data);
    });
  });

  io.use(<span style="color:#080;font-weight:bold">function</span> (socket, next) {
    <span style="color:#777">// Authorize using the /users service</span>
    app.lookup(<span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">'</span><span style="color:#D20">users</span><span style="color:#710">'</span></span>).find({
      <span style="color:#606">username</span>: socket.request.username,
      <span style="color:#606">password</span>: socket.request.password
    }, next);
  });
}));
</pre></div>
</div>
</div>

<p>Similar than the REST middleware, the SocketIO handshakes <code>feathers</code> property will be extended<br />
for service parameters:</p>

<div><div class="CodeRay">
  <div class="code"><pre>app.configure(feathers.socketio(<span style="color:#080;font-weight:bold">function</span>(io) {
  io.use(<span style="color:#080;font-weight:bold">function</span> (socket, next) {
    socket.feathers.user = { <span style="color:#606">name</span>: <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">'</span><span style="color:#D20">David</span><span style="color:#710">'</span></span> };
    next();
  });
}));

app.use(<span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">'</span><span style="color:#D20">todos</span><span style="color:#710">'</span></span>, {
  <span style="color:#06B;font-weight:bold">create</span>: <span style="color:#080;font-weight:bold">function</span>(data, params, callback) {
    <span style="color:#777">// When called via SocketIO:</span>
    params.user <span style="color:#777">// -&gt; { name: 'David' }</span>
  }
});
</pre></div>
</div>
</div>

<p>Once the server has been started with <code>app.listen()</code> the SocketIO object is available as <code>app.io</code>.</p>

<h3 id="primus">Primus</h3>

<p><a href="https://github.com/primus/primus">Primus</a> is a universal wrapper for real-time frameworks and allows you to transparently use Engine.IO, WebSockets, BrowserChannel, SockJS and Socket.IO. Set it up with <code>feathers.primus(configuration [, fn])</code> where <code>configuration</code> is the <a href="https://github.com/primus/primus#getting-started">Primus server configuration</a> and <code>fn</code> an optional callback with the Primus server instance that can e.g. be used for setting up <a href="https://github.com/primus/primus#authorization">authorization</a>:</p>

<div><div class="CodeRay">
  <div class="code"><pre><span style="color:#777">// Set up Primus with SockJS</span>
app.configure(feathers.primus({
  <span style="color:#606">transformer</span>: <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">'</span><span style="color:#D20">sockjs</span><span style="color:#710">'</span></span>
}, <span style="color:#080;font-weight:bold">function</span>(primus) {
  <span style="color:#777">// Set up Primus authorization here</span>
  primus.authorize(<span style="color:#080;font-weight:bold">function</span> (req, done) {
    <span style="color:#080;font-weight:bold">var</span> auth;

    <span style="color:#080;font-weight:bold">try</span> { auth = authParser(req.headers[<span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">'</span><span style="color:#D20">authorization</span><span style="color:#710">'</span></span>]) }
    <span style="color:#080;font-weight:bold">catch</span> (ex) { <span style="color:#080;font-weight:bold">return</span> done(ex) }

    <span style="color:#777">// Do some async auth check</span>
    authCheck(auth, done);
  });
}));
</pre></div>
</div>
</div>

<p>In the Browser you can connect like this:</p>

<div><div class="CodeRay">
  <div class="code"><pre><span style="color:#070;font-weight:bold">&lt;script</span> <span style="color:#b48">type</span>=<span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">&quot;</span><span style="color:#D20">text/javascript</span><span style="color:#710">&quot;</span></span> <span style="color:#b48">src</span>=<span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">&quot;</span><span style="color:#D20">primus/primus.js</span><span style="color:#710">&quot;</span></span><span style="color:#070;font-weight:bold">&gt;</span><span style="color:#070;font-weight:bold">&lt;/script&gt;</span>
<span style="color:#070;font-weight:bold">&lt;script</span> <span style="color:#b48">type</span>=<span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">&quot;</span><span style="color:#D20">text/javascript</span><span style="color:#710">&quot;</span></span><span style="color:#070;font-weight:bold">&gt;</span>
<span style="background-color:hsla(0,0%,0%,0.07);color:black">  <span style="color:#080;font-weight:bold">var</span> primus = <span style="color:#080;font-weight:bold">new</span> Primus(url);

  primus.on(<span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">'</span><span style="color:#D20">todos created</span><span style="color:#710">'</span></span>, <span style="color:#080;font-weight:bold">function</span>(todo) {
    console.log(<span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">'</span><span style="color:#D20">Someone created a Todo</span><span style="color:#710">'</span></span>, todo);
  });

  primus.send(<span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">'</span><span style="color:#D20">todos::create</span><span style="color:#710">'</span></span>, { <span style="color:#606">description</span>: <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">'</span><span style="color:#D20">Do something</span><span style="color:#710">'</span></span> }, {}, <span style="color:#080;font-weight:bold">function</span>() {
    primus.send(<span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">'</span><span style="color:#D20">todos::find</span><span style="color:#710">'</span></span>, {}, <span style="color:#080;font-weight:bold">function</span>(error, todos) {
      console.log(todos);
    });
  });</span>
<span style="color:#070;font-weight:bold">&lt;/script&gt;</span>
</pre></div>
</div>
</div>

<p>Just like REST and SocketIO, the Primus request object can be extended with a <code>feathers</code> parameter during authorization which will extend the <code>params</code> for any service request:</p>

<div><div class="CodeRay">
  <div class="code"><pre>app.configure(feathers.primus({
  <span style="color:#606">transformer</span>: <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">'</span><span style="color:#D20">sockjs</span><span style="color:#710">'</span></span>
}, <span style="color:#080;font-weight:bold">function</span>(primus) {
  <span style="color:#777">// Set up Primus authorization here</span>
  primus.authorize(<span style="color:#080;font-weight:bold">function</span> (req, done) {
    req.feathers = {
      <span style="color:#606">user</span>: { <span style="color:#606">name</span>: <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">'</span><span style="color:#D20">David</span><span style="color:#710">'</span></span> }
    }

    done();
  });
}));
</pre></div>
</div>
</div>

<h2 id="services">Services</h2>

<p>As mentioned, the basic Feathers functionality is fully compatible with Express. The key concept added to that of middleware is *service objects. A service can be any JavaScript object that offers one or more of the <code>find</code>, <code>get</code>, <code>create</code>, <code>update</code>, <code>remove</code> and <code>setup</code> service methods with the following signatures:</p>

<div><div class="CodeRay">
  <div class="code"><pre><span style="color:#080;font-weight:bold">var</span> myService = {
  <span style="color:#06B;font-weight:bold">find</span>: <span style="color:#080;font-weight:bold">function</span>(params, callback) {},
  <span style="color:#06B;font-weight:bold">get</span>: <span style="color:#080;font-weight:bold">function</span>(id, params, callback) {},
  <span style="color:#06B;font-weight:bold">create</span>: <span style="color:#080;font-weight:bold">function</span>(data, params, callback) {},
  <span style="color:#06B;font-weight:bold">update</span>: <span style="color:#080;font-weight:bold">function</span>(id, data, params, callback) {},
  <span style="color:#06B;font-weight:bold">patch</span>: <span style="color:#080;font-weight:bold">function</span>(id, data, params, callback) {},
  <span style="color:#06B;font-weight:bold">remove</span>: <span style="color:#080;font-weight:bold">function</span>(id, params, callback) {},
  <span style="color:#06B;font-weight:bold">setup</span>: <span style="color:#080;font-weight:bold">function</span>(app) {}
}
</pre></div>
</div>
</div>

<p>And can be used like any other Express middleware <code>app.use('/my-service', myService)</code>.</p>

<p>All service callbacks follow the <code>function(error, data)</code> NodeJS convention. <code>params</code> can contain any additional parameters, for example the currently authenticated user. REST service calls set <code>params.query</code> with the query parameters (e.g. a query string like <code>?status=active&amp;type=user</code> becomes <code>{ query: { status: "active", type: "user" } }</code>), socket call parameters will also be passed as <code>params.query</code>.</p>

<p>It is also possible to return a <a href="http://promises-aplus.github.io/promises-spec/">Promise</a> object from a service instead of using the callback, for example using <a href="https://github.com/kriskowal/q">Q</a>:</p>

<div><div class="CodeRay">
  <div class="code"><pre><span style="color:#080;font-weight:bold">var</span> Q = require(<span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">'</span><span style="color:#D20">q</span><span style="color:#710">'</span></span>);

<span style="color:#080;font-weight:bold">var</span> todos = {
  <span style="color:#06B;font-weight:bold">get</span>: <span style="color:#080;font-weight:bold">function</span>(id) {
    <span style="color:#080;font-weight:bold">var</span> dfd = Q.defer();

    setTimeout(<span style="color:#080;font-weight:bold">function</span>() {
      dfd.resolve({
        <span style="color:#606">id</span>: id,
        <span style="color:#606">description</span>: <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">'</span><span style="color:#D20">You have to do </span><span style="color:#710">'</span></span> + id
      });
    }, <span style="color:#00D">500</span>);

    <span style="color:#080;font-weight:bold">return</span> dfd.promise;
  }
}
</pre></div>
</div>
</div>

<h3 id="find">find</h3>

<p><code>find(params, callback)</code> retrieves a list of all resources from the service. SocketIO parameters will be passed as <code>params.query</code> to the service.</p>

<p><strong>REST</strong></p>

<pre><code>GET todo?status=completed&amp;user=10
</code></pre>

<p><strong>SocketIO</strong></p>

<div><div class="CodeRay">
  <div class="code"><pre>socket.emit(<span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">'</span><span style="color:#D20">todo::find</span><span style="color:#710">'</span></span>, {
  <span style="color:#606">status</span>: <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">'</span><span style="color:#D20">completed</span><span style="color:#710">'</span></span>
  user: <span style="color:#00D">10</span>
}, <span style="color:#080;font-weight:bold">function</span>(error, data) {
});
</pre></div>
</div>
</div>

<blockquote>
  <p>Will call .create with <code>params</code> { query: { status: ‘completed’, user: 10 } }</p>
</blockquote>

<h3 id="get">get</h3>

<p><code>get(id, params, callback)</code> retrieves a single resource with the given <code>id</code> from the service.</p>

<p><strong>REST</strong></p>

<pre><code>GET todo/1
</code></pre>

<p><strong>SocketIO</strong></p>

<div><div class="CodeRay">
  <div class="code"><pre>socket.emit(<span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">'</span><span style="color:#D20">todo::get</span><span style="color:#710">'</span></span>, <span style="color:#00D">1</span>, {}, <span style="color:#080;font-weight:bold">function</span>(error, data) {

});
</pre></div>
</div>
</div>

<h3 id="create">create</h3>

<p><code>create(data, params, callback)</code> creates a new resource with <code>data</code>. The callback should be called with the newly<br />
created resource data.</p>

<p><strong>REST</strong></p>

<pre><code>POST todo
{ "description": "I really have to iron" }
</code></pre>

<p>By default the body can be eihter JSON or form encoded as long as the content type is set accordingly.</p>

<p><strong>SocketIO</strong></p>

<div><div class="CodeRay">
  <div class="code"><pre>socket.emit(<span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">'</span><span style="color:#D20">todo::create</span><span style="color:#710">'</span></span>, {
  <span style="color:#606">description</span>: <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">'</span><span style="color:#D20">I really have to iron</span><span style="color:#710">'</span></span>
}, {}, <span style="color:#080;font-weight:bold">function</span>(error, data) {
});
</pre></div>
</div>
</div>

<h3 id="update">update</h3>

<p><code>update(id, data, params, callback)</code> updates the resource identified by <code>id</code> using <code>data</code>. The callback should<br />
be called with the updated resource data.</p>

<p><strong>REST</strong></p>

<pre><code>PUT todo/2
{ "description": "I really have to do laundry" }
</code></pre>

<p><strong>SocketIO</strong></p>

<div><div class="CodeRay">
  <div class="code"><pre>socket.emit(<span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">'</span><span style="color:#D20">todo::update</span><span style="color:#710">'</span></span>, <span style="color:#00D">2</span>, {
  <span style="color:#606">description</span>: <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">'</span><span style="color:#D20">I really have to do laundry</span><span style="color:#710">'</span></span>
}, {}, <span style="color:#080;font-weight:bold">function</span>(error, data) {
  <span style="color:#777">// data -&gt; { id: 2, description: &quot;I really have to do laundry&quot; }</span>
});
</pre></div>
</div>
</div>

<h3 id="patch">patch</h3>

<p><code>patch(id, data, params, callback)</code> patches the resource identified by <code>id</code> using <code>data</code>. The callback should be called with the updated resource data. Implement <code>patch</code> additionally to <code>update</code> if you want to separate between partial and full updates and support the <code>PATCH</code> HTTP method.</p>

<p><strong>REST</strong></p>

<pre><code>PATCH todo/2
{ "description": "I really have to do laundry" }
</code></pre>

<p><strong>SocketIO</strong></p>

<div><div class="CodeRay">
  <div class="code"><pre>socket.emit(<span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">'</span><span style="color:#D20">todo::patch</span><span style="color:#710">'</span></span>, <span style="color:#00D">2</span>, {
  <span style="color:#606">description</span>: <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">'</span><span style="color:#D20">I really have to do laundry</span><span style="color:#710">'</span></span>
}, {}, <span style="color:#080;font-weight:bold">function</span>(error, data) {
  <span style="color:#777">// data -&gt; { id: 2, description: &quot;I really have to do laundry&quot; }</span>
});
</pre></div>
</div>
</div>

<h3 id="remove">remove</h3>

<p><code>remove(id, params, callback)</code> removes the resource with <code>id</code>. The callback should be called with the removed resource.</p>

<p><strong>REST</strong></p>

<pre><code>DELETE todo/2
</code></pre>

<p><strong>SocketIO</strong></p>

<div><div class="CodeRay">
  <div class="code"><pre>socket.emit(<span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">'</span><span style="color:#D20">todo::remove</span><span style="color:#710">'</span></span>, <span style="color:#00D">2</span>, {}, <span style="color:#080;font-weight:bold">function</span>(error, data) {
});
</pre></div>
</div>
</div>

<h3 id="setup">setup</h3>

<p><code>setup(app, path)</code> initializes the service passing an instance of the Feathers application and the path it has been registered on. The SocketIO server is available via <code>app.io</code>. <code>setup</code> is a great way to connect services:</p>

<div><div class="CodeRay">
  <div class="code"><pre><span style="color:#080;font-weight:bold">var</span> todoService = {
  <span style="color:#06B;font-weight:bold">get</span>: <span style="color:#080;font-weight:bold">function</span>(name, params, callback) {
    callback(<span style="color:#069">null</span>, {
      <span style="color:#606">id</span>: name,
      <span style="color:#606">description</span>: <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">'</span><span style="color:#D20">You have to </span><span style="color:#710">'</span></span> + name + <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">'</span><span style="color:#D20">!</span><span style="color:#710">'</span></span>
    });
  }
};

<span style="color:#080;font-weight:bold">var</span> myService = {
  <span style="color:#06B;font-weight:bold">setup</span>: <span style="color:#080;font-weight:bold">function</span>(app) {
    <span style="color:#950">this</span>.todo = app.lookup(<span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">'</span><span style="color:#D20">todo</span><span style="color:#710">'</span></span>);
  },

  <span style="color:#06B;font-weight:bold">get</span>: <span style="color:#080;font-weight:bold">function</span>(name, params, callback) {
    <span style="color:#950">this</span>.todo.get(<span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">'</span><span style="color:#D20">take out trash</span><span style="color:#710">'</span></span>, {}, <span style="color:#080;font-weight:bold">function</span>(error, todo) {
      callback(error, {
        <span style="color:#606">name</span>: name,
        <span style="color:#606">todo</span>: todo
      });
    });
  }
}

feathers()
    .use(<span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">'</span><span style="color:#D20">todo</span><span style="color:#710">'</span></span>, todoService)
    .use(<span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">'</span><span style="color:#D20">my</span><span style="color:#710">'</span></span>, myService)
    .listen(<span style="color:#00D">8000</span>);
</pre></div>
</div>
</div>

<p>You can see the combination when going to <code>http://localhost:8000/my/test</code>.</p>

<p><strong>Pro tip:</strong></p>

<p>Bind the apps <code>lookup</code> method to your service to always look your services up dynamically:</p>

<pre><code>var myService = {
  setup: function(app) {
    this.lookup = app.lookup.bind(app);
  },

  get: function(name, params, callback) {
    this.lookup('todos').get('take out trash', {}, function(error, todo) {
      callback(null, {
        name: name,
        todo: todo
      });
    });
  }
}
</code></pre>

<h2 id="events">Events</h2>

<p>Any registered service will be automatically turned into an event emitter that emits events when a resource has changed, that is a <code>create</code>, <code>update</code> or <code>remove</code> service call returned successfully. It is therefore possible to bind to the below events via <code>app.lookup(servicename).on()</code> and, if enabled, all events will also broadcast to all connected SocketIO clients in the form of <code>&lt;servicepath&gt; &lt;eventname&gt;</code>. Note that the service path will always be stripped of leading and trailing slashes regardless of how it has been registered (e.g. <code>/my/service/</code> will become <code>my/service</code>).</p>

<h3 id="created">created</h3>

<p>The <code>created</code> event will be published with the callback data when a service <code>create</code> calls back successfully.</p>

<div><div class="CodeRay">
  <div class="code"><pre>app.use(<span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">'</span><span style="color:#D20">/todos</span><span style="color:#710">'</span></span>, {
  <span style="color:#06B;font-weight:bold">create</span>: <span style="color:#080;font-weight:bold">function</span>(data, params, callback) {
    callback(<span style="color:#069">null</span>, data);
  }
});

app.lookup(<span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">'</span><span style="color:#D20">/todos</span><span style="color:#710">'</span></span>).on(<span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">'</span><span style="color:#D20">created</span><span style="color:#710">'</span></span>, <span style="color:#080;font-weight:bold">function</span>(todo) {
  console.log(<span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">'</span><span style="color:#D20">Created todo</span><span style="color:#710">'</span></span>, todo);
});

app.lookup(<span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">'</span><span style="color:#D20">/todos</span><span style="color:#710">'</span></span>).create({
  <span style="color:#606">description</span>: <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">'</span><span style="color:#D20">We have to do something!</span><span style="color:#710">'</span></span>
}, {}, <span style="color:#080;font-weight:bold">function</span>(error, callback) {
  <span style="color:#777">// ...</span>
});

app.listen(<span style="color:#00D">8000</span>);
</pre></div>
</div>
</div>

<p><strong>SocketIO</strong></p>

<div><div class="CodeRay">
  <div class="code"><pre><span style="color:#070;font-weight:bold">&lt;script</span> <span style="color:#b48">src</span>=<span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">&quot;</span><span style="color:#D20">http://localhost:8000/socket.io/socket.io.js</span><span style="color:#710">&quot;</span></span><span style="color:#070;font-weight:bold">&gt;</span><span style="color:#070;font-weight:bold">&lt;/script&gt;</span>
<span style="color:#070;font-weight:bold">&lt;script&gt;</span>
<span style="background-color:hsla(0,0%,0%,0.07);color:black">  <span style="color:#080;font-weight:bold">var</span> socket = io.connect(<span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">'</span><span style="color:#D20">http://localhost:8000/</span><span style="color:#710">'</span></span>);

  socket.on(<span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">'</span><span style="color:#D20">todos created</span><span style="color:#710">'</span></span>, <span style="color:#080;font-weight:bold">function</span>(todo) {
    console.log(<span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">'</span><span style="color:#D20">Got a new Todo!</span><span style="color:#710">'</span></span>, todo);
  });</span>
<span style="color:#070;font-weight:bold">&lt;/script&gt;</span>
</pre></div>
</div>
</div>

<h3 id="updated-patched">updated, patched</h3>

<p>The <code>updated</code> and <code>patched</code> events will be published with the callback data when a service <code>update</code> or <code>patch</code> method calls back successfully.</p>

<div><div class="CodeRay">
  <div class="code"><pre>app.use(<span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">'</span><span style="color:#D20">/my/todos/</span><span style="color:#710">'</span></span>, {
  <span style="color:#06B;font-weight:bold">update</span>: <span style="color:#080;font-weight:bold">function</span>(id, data, params, callback) {
    callback(<span style="color:#069">null</span>, data);
  }
});

app.listen(<span style="color:#00D">8000</span>);
</pre></div>
</div>
</div>

<p><strong>SocketIO</strong></p>

<div><div class="CodeRay">
  <div class="code"><pre><span style="color:#070;font-weight:bold">&lt;script</span> <span style="color:#b48">src</span>=<span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">&quot;</span><span style="color:#D20">http://localhost:8000/socket.io/socket.io.js</span><span style="color:#710">&quot;</span></span><span style="color:#070;font-weight:bold">&gt;</span><span style="color:#070;font-weight:bold">&lt;/script&gt;</span>
<span style="color:#070;font-weight:bold">&lt;script&gt;</span>
<span style="background-color:hsla(0,0%,0%,0.07);color:black">  <span style="color:#080;font-weight:bold">var</span> socket = io.connect(<span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">'</span><span style="color:#D20">http://localhost:8000/</span><span style="color:#710">'</span></span>);

  socket.on(<span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">'</span><span style="color:#D20">my/todos updated</span><span style="color:#710">'</span></span>, <span style="color:#080;font-weight:bold">function</span>(todo) {
    console.log(<span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">'</span><span style="color:#D20">Got an updated Todo!</span><span style="color:#710">'</span></span>, todo);
  });

  socket.emit(<span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">'</span><span style="color:#D20">my/todos::update</span><span style="color:#710">'</span></span>, <span style="color:#00D">1</span>, {
    <span style="color:#606">description</span>: <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">'</span><span style="color:#D20">Updated description</span><span style="color:#710">'</span></span>
  }, {}, <span style="color:#080;font-weight:bold">function</span>(error, callback) {
   <span style="color:#777">// Do something here</span>
  });</span>
<span style="color:#070;font-weight:bold">&lt;/script&gt;</span>
</pre></div>
</div>
</div>

<h3 id="removed">removed</h3>

<p>The <code>removed</code> event will be published with the callback data when a service <code>remove</code> calls back successfully.</p>

<div><div class="CodeRay">
  <div class="code"><pre>app.use(<span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">'</span><span style="color:#D20">/todos</span><span style="color:#710">'</span></span>, {
  <span style="color:#06B;font-weight:bold">remove</span>: <span style="color:#080;font-weight:bold">function</span>(id, params, callback) {
    callback(<span style="color:#069">null</span>, { <span style="color:#606">id</span>: id });
  }
});

app.lookup(<span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">'</span><span style="color:#D20">/todos</span><span style="color:#710">'</span></span>).remove(<span style="color:#00D">1</span>, {}, <span style="color:#080;font-weight:bold">function</span>(error, callback) {
  <span style="color:#777">// ...</span>
});

app.listen(<span style="color:#00D">8000</span>);
</pre></div>
</div>
</div>

<p><strong>SocketIO</strong></p>

<div><div class="CodeRay">
  <div class="code"><pre><span style="color:#070;font-weight:bold">&lt;script</span> <span style="color:#b48">src</span>=<span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">&quot;</span><span style="color:#D20">http://localhost:8000/socket.io/socket.io.js</span><span style="color:#710">&quot;</span></span><span style="color:#070;font-weight:bold">&gt;</span><span style="color:#070;font-weight:bold">&lt;/script&gt;</span>
<span style="color:#070;font-weight:bold">&lt;script&gt;</span>
<span style="background-color:hsla(0,0%,0%,0.07);color:black">  <span style="color:#080;font-weight:bold">var</span> socket = io.connect(<span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">'</span><span style="color:#D20">http://localhost:8000/</span><span style="color:#710">'</span></span>);

  socket.on(<span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">'</span><span style="color:#D20">todos removed</span><span style="color:#710">'</span></span>, <span style="color:#080;font-weight:bold">function</span>(todo) {
    <span style="color:#777">// Remove element showing the Todo from the page</span>
    <span style="color:#369;font-weight:bold">$</span>(<span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">'</span><span style="color:#D20">#todo-</span><span style="color:#710">'</span></span> + todo.id).remove();
  });</span>
<span style="color:#070;font-weight:bold">&lt;/script&gt;</span>
</pre></div>
</div>
</div>

<h3 id="event-filtering">Event filtering</h3>

<p>By default all service events will be dispatched to all connected clients.<br />
In many cases you probably want to be able to only dispatch events for certain clients.<br />
This can be done by implementing the <code>created</code>, <code>updated</code>, <code>patched</code> and <code>removed</code> methods as <code>function(data, params, callback) {}</code> with <code>params</code> being the parameters set when the client connected, in SocketIO when authorizing and setting <code>handshake.feathers</code> and Primus with <code>req.feathers</code>.</p>

<div><div class="CodeRay">
  <div class="code"><pre><span style="color:#080;font-weight:bold">var</span> myService = {
  <span style="color:#06B;font-weight:bold">created</span>: <span style="color:#080;font-weight:bold">function</span>(data, params, callback) {},
  <span style="color:#06B;font-weight:bold">updated</span>: <span style="color:#080;font-weight:bold">function</span>(data, params, callback) {},
  <span style="color:#06B;font-weight:bold">patched</span>: <span style="color:#080;font-weight:bold">function</span>(data, params, callback) {},
  <span style="color:#06B;font-weight:bold">removed</span>: <span style="color:#080;font-weight:bold">function</span>(data, params, callback) {}
}
</pre></div>
</div>
</div>

<p>The event dispatching service methods will be run for every connected client. Calling the callback with data (that you also may modify) will dispatch the according event. Callling back with a falsy value will prevent the event being dispatched to this client.</p>

<p>The following example only dispatches the Todo <code>updated</code> event if the authorized user belongs to the same company:</p>

<div><div class="CodeRay">
  <div class="code"><pre>app.configure(feathers.socketio(<span style="color:#080;font-weight:bold">function</span>(io) {
  io.use(<span style="color:#080;font-weight:bold">function</span> (socket, callback) {
    <span style="color:#777">// Authorize using the /users service</span>
    app.lookup(<span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">'</span><span style="color:#D20">users</span><span style="color:#710">'</span></span>).find({
      <span style="color:#606">username</span>: handshake.username,
      <span style="color:#606">password</span>: handshake.password
    }, <span style="color:#080;font-weight:bold">function</span>(error, user) {
      <span style="color:#080;font-weight:bold">if</span>(!error || !user) {
        <span style="color:#080;font-weight:bold">return</span> callback(error, <span style="color:#069">false</span>);
      }

      socket.feathers = {
        <span style="color:#606">user</span>: user
      };

      callback(<span style="color:#069">null</span>, <span style="color:#069">true</span>);
    });
  });
}));

app.use(<span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">'</span><span style="color:#D20">todos</span><span style="color:#710">'</span></span>, {
  <span style="color:#06B;font-weight:bold">update</span>: <span style="color:#080;font-weight:bold">function</span>(id, data, params, callback) {
    <span style="color:#777">// Update</span>
    callback(<span style="color:#069">null</span>, data);
  },

  <span style="color:#06B;font-weight:bold">updated</span>: <span style="color:#080;font-weight:bold">function</span>(todo, params, callback) {
    <span style="color:#777">// params === handshake.feathers</span>
    <span style="color:#080;font-weight:bold">if</span>(todo.companyId === params.user.companyId) {
      <span style="color:#777">// Dispatch the todo data to this client</span>
      <span style="color:#080;font-weight:bold">return</span> callback(<span style="color:#069">null</span>, todo);
    }

    <span style="color:#777">// Call back with a falsy value to prevent dispatching</span>
    callback(<span style="color:#069">null</span>, <span style="color:#069">false</span>);
  }
});
</pre></div>
</div>
</div>

<p>On the client:</p>

<div><div class="CodeRay">
  <div class="code"><pre>socket.on(<span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">'</span><span style="color:#D20">todo updated</span><span style="color:#710">'</span></span>, <span style="color:#080;font-weight:bold">function</span>(data) {
  <span style="color:#777">// The client will only get this event</span>
  <span style="color:#777">// if authorized and in the same company</span>
});
</pre></div>
</div>
</div>

<h2 id="api">API</h2>

<h3 id="listen">listen</h3>

<p><code>app.listen([port])</code> starts the application on the given port. It will first call the original <a href="http://expressjs.com/api.html#app.listen">Express app.listen([port])</a>, then run <code>app.setup(server)</code> (see below) with the server object and then return the server object.</p>

<h3 id="setup-1">setup</h3>

<p><code>app.setup(server)</code> is used initialize all services by calling each services <code>.setup(app, path)</code> method (if available).<br />
It will also use the <code>server</code> instance passed (e.g. through <code>http.createServer</code>) to set up SocketIO (if enabled) and any other provider that might require the server instance.</p>

<p>Normally <code>app.setup</code> will be called automatically when starting the application via <code>app.listen([port])</code> but there are cases when you need to initialize the server separately:</p>

<p><strong>HTTPS</strong></p>

<p>With your Feathers application initialized it is easy to set up an HTTPS REST and SocketIO server:</p>

<div><div class="CodeRay">
  <div class="code"><pre>app.configure(feathers.socketio()).use(<span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">'</span><span style="color:#D20">/todos</span><span style="color:#710">'</span></span>, todoService);

<span style="color:#080;font-weight:bold">var</span> https = require(<span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">'</span><span style="color:#D20">https</span><span style="color:#710">'</span></span>);
<span style="color:#080;font-weight:bold">var</span> server = https.createServer({
  <span style="color:#606">key</span>: fs.readFileSync(<span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">'</span><span style="color:#D20">privatekey.pem</span><span style="color:#710">'</span></span>),
  <span style="color:#606">cert</span>: fs.readFileSync(<span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">'</span><span style="color:#D20">certificate.pem</span><span style="color:#710">'</span></span>)
}, app).listen(<span style="color:#00D">443</span>);

<span style="color:#777">// Call app.setup to initialize all services and SocketIO</span>
app.setup(server);
</pre></div>
</div>
</div>

<p><strong>Virtual Hosts</strong></p>

<p>You can use <code>feathers.vhost</code> (which is the same as <a href="http://www.senchalabs.org/connect/vhost.html">Express and Connect .vhost</a>) to run your Feathers app on a virtual host:</p>

<div><div class="CodeRay">
  <div class="code"><pre>app.use(<span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">'</span><span style="color:#D20">/todos</span><span style="color:#710">'</span></span>, todoService);

<span style="color:#080;font-weight:bold">var</span> host = feathers().use(feathers.vhost(<span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">'</span><span style="color:#D20">foo.com</span><span style="color:#710">'</span></span>, app));
<span style="color:#080;font-weight:bold">var</span> server = host.listen(<span style="color:#00D">8080</span>);

<span style="color:#777">// Here we need to call app.setup because .listen on our virtal hosted</span>
<span style="color:#777">// app is never called</span>
app.setup(server);
</pre></div>
</div>
</div>

<h3 id="lookup">lookup</h3>

<p><code>app.lookup(path)</code> returns the wrapped service object for the given path. Note that Feathers internally creates a new object from each registered service. This means that the object returned by <code>lookup</code> will provide the same methods and functionality as the original service but also functionality added by Feathers (most notably it is possible to listen to service events). <code>path</code> can be the service name with or without leading and trailing slashes.</p>

<div><div class="CodeRay">
  <div class="code"><pre>app.use(<span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">'</span><span style="color:#D20">/my/todos</span><span style="color:#710">'</span></span>, {
  <span style="color:#06B;font-weight:bold">create</span>: <span style="color:#080;font-weight:bold">function</span>(data, params, callback) {
    callback(<span style="color:#069">null</span>, data);
  }
});

<span style="color:#080;font-weight:bold">var</span> todoService = app.lookup(<span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">'</span><span style="color:#D20">my/todos</span><span style="color:#710">'</span></span>);
<span style="color:#777">// todoService is an event emitter</span>
todoService.on(<span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">'</span><span style="color:#D20">created</span><span style="color:#710">'</span></span>, <span style="color:#080;font-weight:bold">function</span>(todo) {
  console.log(<span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">'</span><span style="color:#D20">Created todo</span><span style="color:#710">'</span></span>, todo);
});
</pre></div>
</div>
</div>

<h3 id="use">use</h3>

<p><code>app.use([path], service)</code> works just like <a href="http://expressjs.com/api.html#app.use">Express app.use([path], middleware)</a> but additionally allows to register a service object (an object which at least provides one of the service methods as outlined in the Services section) instead of the middleware function. Note that REST services are registered in the same order as any other middleware so the below example will allow the <code>/todos</code> service only to <a href="http://passportjs.org/">Passport</a> authenticated users.</p>

<div><div class="CodeRay">
  <div class="code"><pre><span style="color:#777">// Serve public folder for everybody</span>
app.use(feathers.<span style="color:#080;font-weight:bold">static</span>(__dirname + <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">'</span><span style="color:#D20">/public</span><span style="color:#710">'</span></span>);
<span style="color:#777">// Make sure that everything else only works with authentication</span>
app.use(<span style="color:#080;font-weight:bold">function</span>(req,res,next){
  <span style="color:#080;font-weight:bold">if</span>(req.isAuthenticated()){
    next();
  } <span style="color:#080;font-weight:bold">else</span> {
    <span style="color:#777">// 401 Not Authorized</span>
    next(<span style="color:#080;font-weight:bold">new</span> Error(<span style="color:#00D">401</span>));
  }
});
<span style="color:#777">// Add a service.</span>
app.use(<span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">'</span><span style="color:#D20">/todos</span><span style="color:#710">'</span></span>, {
  <span style="color:#06B;font-weight:bold">get</span>: <span style="color:#080;font-weight:bold">function</span>(name, params, callback) {
    callback(<span style="color:#069">null</span>, {
      <span style="color:#606">id</span>: name,
      <span style="color:#606">description</span>: <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">&quot;</span><span style="color:#D20">You have to do </span><span style="color:#710">&quot;</span></span> + name + <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">&quot;</span><span style="color:#D20">!</span><span style="color:#710">&quot;</span></span>
    });
  }
});
</pre></div>
</div>
</div>

<h3 id="service">service</h3>

<p><code>app.service([path], service)</code> is what is called internally by <code>app.use([path], service)</code> if a service object is being passed. Use it instead of <code>app.use([path], service)</code> if you want to be more explicit that you are registering a service. <code>app.service</code> does <strong>not</strong> provide the Express <code>app.use</code> functionality and doesn’t check the service object for valid methods.</p>

<h2 id="why">Why?</h2>

<p>We know! Oh God another NodeJS framework! We really didn’t want to add another name to the long list of NodeJS web frameworks but also wanted to explore a different approach than any other framework we have seen. We strongly believe that data is the core of the web and should be the focus of web applications.</p>

<p>We also think that your data resources can and should be encapsulated in such a way that they can be scalable, easily testable and self contained. The classic web MVC pattern used to work well but is becoming antiquated in today’s web.</p>

<p>With that being said there are some amazing frameworks already out there and we wanted to leverage the ideas that have been put into them, which is why Feathers is built on top of <a href="http://expressjs.com">Express</a> and is inspired in part by <a href="http://sailsjs.org">Sails</a>, <a href="http://flatironjs.org">Flatiron</a> and <a href="http://derbyjs.com">Derby</a>.</p>

      </div>
    </div>
  </div>
</section>
</div>

    <footer>
      <div class="row">
        <div class="col-md-4">
          <p>© 2013 Feathers.</p>
        </div>
        <div class="col-md-4">
          <p> Another project made with <i class="icon-heart"></i> by <a href="http://twitter.com/daffl" title="David Luecke" target="_blank">@daffl</a> and <a href="http://twitter.com/ekryski" title="Eric Kryski" target="_blank">@ekryski</a>.</p>
        </div>
        <div class="col-md-4">
          <p class="back pull-right"><a href="#hero">Back to top</a></p>
        </div>
      </div>
    </footer>

    <script src="http://todos.feathersjs.com/socket.io/socket.io.js"></script>
    <script src="//ajax.googleapis.com/ajax/libs/jquery/1.11.0/jquery.min.js"></script>
    <script src="//netdna.bootstrapcdn.com/bootstrap/3.1.1/js/bootstrap.min.js"></script>
    <script src="/js/todos.js"></script>
    <script src="/js/feathers.js"></script>
  </body>
</html>
